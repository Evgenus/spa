(function(){"use strict";var t={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(t){this.toString=function(){return"CORRUPT: "+this.message},this.message=t},invalid:function(t){this.toString=function(){return"INVALID: "+this.message},this.message=t},bug:function(t){this.toString=function(){return"BUG: "+this.message},this.message=t},notReady:function(t){this.toString=function(){return"NOT READY: "+this.message},this.message=t}}};return"undefined"!=typeof module&&module.exports&&(module.exports=t),t.bitArray={bitSlice:function(i,e,r){return i=t.bitArray._shiftRight(i.slice(e/32),32-(31&e)).slice(1),void 0===r?i:t.bitArray.clamp(i,r-e)},extract:function(t,i,e){var r,n=Math.floor(-i-e&31);return r=-32&(i+e-1^i)?t[i/32|0]<<32-n^t[i/32+1|0]>>>n:t[i/32|0]>>>n,r&(1<<e)-1},concat:function(i,e){if(0===i.length||0===e.length){return i.concat(e)}var s=i[i.length-1],h=t.bitArray.getPartial(s);return 32===h?i.concat(e):t.bitArray._shiftRight(e,h,0|s,i.slice(0,i.length-1))},bitLength:function(i){var r,e=i.length;return 0===e?0:(r=i[e-1],32*(e-1)+t.bitArray.getPartial(r))},clamp:function(i,e){if(32*i.length<e){return i}i=i.slice(0,Math.ceil(e/32));var r=i.length;return e=31&e,r>0&&e&&(i[r-1]=t.bitArray.partial(e,i[r-1]&2147483648>>e-1,1)),i},partial:function(t,i,e){return 32===t?i:(e?0|i:i<<32-t)+1099511627776*t},getPartial:function(t){return Math.round(t/1099511627776)||32},equal:function(i,e){if(t.bitArray.bitLength(i)!==t.bitArray.bitLength(e)){return!1}var n,r=0;for(n=0;n<i.length;n++){r|=i[n]^e[n]}return 0===r},_shiftRight:function(i,e,r,n){var s,a,h=0;for(void 0===n&&(n=[]);e>=32;e-=32){n.push(r),r=0}if(0===e){return n.concat(i)}for(s=0;s<i.length;s++){n.push(r|i[s]>>>e),r=i[s]<<32-e}return h=i.length?i[i.length-1]:0,a=t.bitArray.getPartial(h),n.push(t.bitArray.partial(e+a&31,e+a>32?r:n.pop(),1)),n},_xor4:function(t,i){return[t[0]^i[0],t[1]^i[1],t[2]^i[2],t[3]^i[3]]}},t.codec.bytes={fromBits:function(i){var n,s,e=[],r=t.bitArray.bitLength(i);for(n=0;r/8>n;n++){0===(3&n)&&(s=i[n/4]),e.push(s>>>24),s<<=8}return e},toBits:function(i){var r,e=[],n=0;for(r=0;r<i.length;r++){n=n<<8|i[r],3===(3&r)&&(e.push(n),n=0)}return 3&r&&e.push(t.bitArray.partial(8*(3&r),n)),e}},t.codec.utf8String={fromBits:function(i){var n,s,e="",r=t.bitArray.bitLength(i);for(n=0;r/8>n;n++){0===(3&n)&&(s=i[n/4]),e+=String.fromCharCode(s>>>24),s<<=8}return decodeURIComponent(escape(e))},toBits:function(i){i=unescape(encodeURIComponent(i));var r,e=[],n=0;for(r=0;r<i.length;r++){n=n<<8|i.charCodeAt(r),3===(3&r)&&(e.push(n),n=0)}return 3&r&&e.push(t.bitArray.partial(8*(3&r),n)),e}},t.codec.hex={fromBits:function(i){var r,e="";for(r=0;r<i.length;r++){e+=((0|i[r])+0xf00000000000).toString(16).substr(4)}return e.substr(0,t.bitArray.bitLength(i)/4)},toBits:function(i){var e,n,r=[];for(i=i.replace(/\s|0x/g,""),n=i.length,i+="00000000",e=0;e<i.length;e+=8){r.push(0^parseInt(i.substr(e,8),16))}return t.bitArray.clamp(r,4*n)}},t.cipher.aes=function(i){this._tables[0][0][0]||this._precompute();var e,r,n,s,h,a=this._tables[0][4],o=this._tables[1],c=i.length,f=1;if(4!==c&&6!==c&&8!==c){throw new t.exception.invalid("invalid aes key size")}for(this._key=[s=i.slice(0),h=[]],e=c;4*c+28>e;e++){n=s[e-1],(e%c===0||8===c&&e%c===4)&&(n=a[n>>>24]<<24^a[n>>16&255]<<16^a[n>>8&255]<<8^a[255&n],e%c===0&&(n=n<<8^n>>>24^f<<24,f=f<<1^283*(f>>7))),s[e]=s[e-c]^n}for(r=0;e;r++,e--){n=s[3&r?e:e-4],h[r]=4>=e||4>r?n:o[0][a[n>>>24]]^o[1][a[n>>16&255]]^o[2][a[n>>8&255]]^o[3][a[255&n]]}},t.cipher.aes.prototype={encrypt:function(t){return this._crypt(t,0)},decrypt:function(t){return this._crypt(t,1)},_tables:[[[],[],[],[],[]],[[],[],[],[],[]]],_precompute:function(){var n,s,h,c,f,u,l,p,g,t=this._tables[0],i=this._tables[1],e=t[4],r=i[4],a=[],o=[];for(n=0;256>n;n++){o[(a[n]=n<<1^283*(n>>7))^n]=n}for(s=h=0;!e[s];s^=c||1,h=o[h]||1){for(l=h^h<<1^h<<2^h<<3^h<<4,l=l>>8^255&l^99,e[s]=l,r[l]=s,u=a[f=a[c=a[s]]],g=16843009*u^65537*f^257*c^16843008*s,p=257*a[l]^16843008*l,n=0;4>n;n++){t[n][s]=p=p<<24^p>>>8,i[n][l]=g=g<<24^g>>>8}}for(n=0;5>n;n++){t[n]=t[n].slice(0),i[n]=i[n].slice(0)}},_crypt:function(i,e){if(4!==i.length){throw new t.exception.invalid("invalid aes block size")}var o,c,f,l,r=this._key[e],n=i[0]^r[0],s=i[e?3:1]^r[1],h=i[2]^r[2],a=i[e?1:3]^r[3],u=r.length/4-2,p=4,g=[0,0,0,0],b=this._tables[e],y=b[0],_=b[1],d=b[2],v=b[3],m=b[4];for(l=0;u>l;l++){o=y[n>>>24]^_[s>>16&255]^d[h>>8&255]^v[255&a]^r[p],c=y[s>>>24]^_[h>>16&255]^d[a>>8&255]^v[255&n]^r[p+1],f=y[h>>>24]^_[a>>16&255]^d[n>>8&255]^v[255&s]^r[p+2],a=y[a>>>24]^_[n>>16&255]^d[s>>8&255]^v[255&h]^r[p+3],p+=4,n=o,s=c,h=f}for(l=0;4>l;l++){g[e?3&-l:l]=m[n>>>24]<<24^m[s>>16&255]<<16^m[h>>8&255]<<8^m[255&a]^r[p++],o=n,n=s,s=h,h=a,a=o}return g}},t.hash.sha256=function(t){this._key[0]||this._precompute(),t?(this._h=t._h.slice(0),this._buffer=t._buffer.slice(0),this._length=t._length):this.reset()},t.hash.sha256.hash=function(i){return(new t.hash.sha256).update(i).finalize()},t.hash.sha256.prototype={blockSize:512,reset:function(){return this._h=this._init.slice(0),this._buffer=[],this._length=0,this},update:function(i){"string"==typeof i&&(i=t.codec.utf8String.toBits(i));var e,r=this._buffer=t.bitArray.concat(this._buffer,i),n=this._length,s=this._length=n+t.bitArray.bitLength(i);for(e=512+n&-512;s>=e;e+=512){this._block(r.splice(0,16))}return this},finalize:function(){var i,e=this._buffer,r=this._h;for(e=t.bitArray.concat(e,[t.bitArray.partial(1,1)]),i=e.length+2;15&i;i++){e.push(0)}for(e.push(Math.floor(this._length/4294967296)),e.push(0|this._length);e.length;){this._block(e.splice(0,16))}return this.reset(),r},_init:[],_key:[],_precompute:function(){function r(t){return 4294967296*(t-Math.floor(t))|0}var e,t=0,i=2;t:for(;64>t;i++){for(e=2;i>=e*e;e++){if(i%e===0){continue t}}8>t&&(this._init[t]=r(Math.pow(i,.5))),this._key[t]=r(Math.pow(i,1/3)),t++}},_block:function(t){var i,e,r,n,s=t.slice(0),h=this._h,a=this._key,o=h[0],c=h[1],f=h[2],u=h[3],l=h[4],p=h[5],g=h[6],b=h[7];for(i=0;64>i;i++){16>i?e=s[i]:(r=s[i+1&15],n=s[i+14&15],e=s[15&i]=(r>>>7^r>>>18^r>>>3^r<<25^r<<14)+(n>>>17^n>>>19^n>>>10^n<<15^n<<13)+s[15&i]+s[i+9&15]|0),e=e+b+(l>>>6^l>>>11^l>>>25^l<<26^l<<21^l<<7)+(g^l&(p^g))+a[i],b=g,g=p,p=l,l=u+e|0,u=f,f=c,c=o,o=e+(c&f^u&(c^f))+(c>>>2^c>>>13^c>>>22^c<<30^c<<19^c<<10)|0}h[0]=h[0]+o|0,h[1]=h[1]+c|0,h[2]=h[2]+f|0,h[3]=h[3]+u|0,h[4]=h[4]+l|0,h[5]=h[5]+p|0,h[6]=h[6]+g|0,h[7]=h[7]+b|0}},t.misc.hmac=function(i,e){this._hash=e=e||t.hash.sha256;var n,r=[[],[]],s=e.prototype.blockSize/32;for(this._baseHash=[new e,new e],i.length>s&&(i=e.hash(i)),n=0;s>n;n++){r[0][n]=909522486^i[n],r[1][n]=1549556828^i[n]}this._baseHash[0].update(r[0]),this._baseHash[1].update(r[1]),this._resultHash=new e(this._baseHash[0])},t.misc.hmac.prototype.encrypt=t.misc.hmac.prototype.mac=function(i){if(this._updated){throw new t.exception.invalid("encrypt on already updated hmac called!")}return this.update(i),this.digest(i)},t.misc.hmac.prototype.reset=function(){this._resultHash=new this._hash(this._baseHash[0]),this._updated=!1},t.misc.hmac.prototype.update=function(t){this._updated=!0,this._resultHash.update(t)},t.misc.hmac.prototype.digest=function(){var t=this._resultHash.finalize(),i=new this._hash(this._baseHash[1]).update(t).finalize();return this.reset(),i},t.misc.pbkdf2=function(i,e,r,n,s){if(r=r||1e3,0>n||0>r){throw t.exception.invalid("invalid params to pbkdf2")}"string"==typeof i&&(i=t.codec.utf8String.toBits(i)),"string"==typeof e&&(e=t.codec.utf8String.toBits(e)),s=s||t.misc.hmac;var a,o,c,f,u,h=new s(i),l=[],p=t.bitArray;for(u=1;32*l.length<(n||1);u++){for(a=o=h.encrypt(p.concat(e,[u])),c=1;r>c;c++){for(o=h.encrypt(o),f=0;f<o.length;f++){a[f]^=o[f]}}l=l.concat(a)}return n&&(l=p.clamp(l,n)),l},void 0===t.beware&&(t.beware={}),t.beware["CBC mode is dangerous because it doesn't protect message integrity."]=function(){t.mode.cbc={name:"cbc",encrypt:function(i,e,r,n){if(n&&n.length){throw new t.exception.invalid("cbc can't authenticate data")}if(128!==t.bitArray.bitLength(r)){throw new t.exception.invalid("cbc iv must be 128 bits")}var s,h=t.bitArray,a=h._xor4,o=h.bitLength(e),c=0,f=[];if(7&o){throw new t.exception.invalid("pkcs#5 padding only works for multiples of a byte")}for(s=0;o>=c+128;s+=4,c+=128){r=i.encrypt(a(r,e.slice(s,s+4))),f.splice(s,0,r[0],r[1],r[2],r[3])}return o=16843009*(16-(o>>3&15)),r=i.encrypt(a(r,h.concat(e,[o,o,o,o]).slice(s,s+4))),f.splice(s,0,r[0],r[1],r[2],r[3]),f},decrypt:function(i,e,r,n){if(n&&n.length){throw new t.exception.invalid("cbc can't authenticate data")}if(128!==t.bitArray.bitLength(r)){throw new t.exception.invalid("cbc iv must be 128 bits")}if(127&t.bitArray.bitLength(e)||!e.length){throw new t.exception.corrupt("cbc ciphertext must be a positive multiple of the block size")}var s,o,c,h=t.bitArray,a=h._xor4,f=[];for(n=n||[],s=0;s<e.length;s+=4){o=e.slice(s,s+4),c=a(r,i.decrypt(o)),f.splice(s,0,c[0],c[1],c[2],c[3]),r=o}if(o=255&f[s-1],0===o||o>16){throw new t.exception.corrupt("pkcs#5 padding corrupt")}if(c=16843009*o,!h.equal(h.bitSlice([c,c,c,c],0,8*o),h.bitSlice(f,32*f.length-8*o,32*f.length))){throw new t.exception.corrupt("pkcs#5 padding corrupt")}return h.bitSlice(f,0,32*f.length-8*o)}}},function(i,e,r){var n;if(i instanceof ArrayBuffer){var s=new Uint8Array(i);n=t.codec.bytes.toBits(s)}else{i instanceof Buffer&&(n=t.codec.bytes.toBits(i))}var h=t.codec.hex.toBits(r.salt),a=t.codec.hex.toBits(r.iv),o=t.misc.pbkdf2(e,h,r.iter).slice(0,r.ks/32),c=new t.cipher.aes(o),f=t.codec.utf8String.toBits(r.auth),u=t.mode.cbc.decrypt(c,n,a,f,r.ts);return t.codec.utf8String.fromBits(u)}})();