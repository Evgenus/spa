(function(){"use strict";var t={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(t){this.toString=function(){return"CORRUPT: "+this.message},this.message=t},invalid:function(t){this.toString=function(){return"INVALID: "+this.message},this.message=t},bug:function(t){this.toString=function(){return"BUG: "+this.message},this.message=t},notReady:function(t){this.toString=function(){return"NOT READY: "+this.message},this.message=t}}};"undefined"!=typeof module&&module.exports&&(module.exports=t),t.bitArray={bitSlice:function(i,r,e){return i=t.bitArray._shiftRight(i.slice(r/32),32-(31&r)).slice(1),void 0===e?i:t.bitArray.clamp(i,e-r)},extract:function(t,i,r){var e,n=Math.floor(-i-r&31);return e=-32&(i+r-1^i)?t[i/32|0]<<32-n^t[i/32+1|0]>>>n:t[i/32|0]>>>n,e&(1<<r)-1},concat:function(i,r){if(0===i.length||0===r.length){return i.concat(r)}var s=i[i.length-1],o=t.bitArray.getPartial(s);return 32===o?i.concat(r):t.bitArray._shiftRight(r,o,0|s,i.slice(0,i.length-1))},bitLength:function(i){var e,r=i.length;return 0===r?0:(e=i[r-1],32*(r-1)+t.bitArray.getPartial(e))},clamp:function(i,r){if(32*i.length<r){return i}i=i.slice(0,Math.ceil(r/32));var e=i.length;return r=31&r,e>0&&r&&(i[e-1]=t.bitArray.partial(r,i[e-1]&2147483648>>r-1,1)),i},partial:function(t,i,r){return 32===t?i:(r?0|i:i<<32-t)+1099511627776*t},getPartial:function(t){return Math.round(t/1099511627776)||32},equal:function(i,r){if(t.bitArray.bitLength(i)!==t.bitArray.bitLength(r)){return!1}var n,e=0;for(n=0;n<i.length;n++){e|=i[n]^r[n]}return 0===e},_shiftRight:function(i,r,e,n){var s,a,o=0;for(void 0===n&&(n=[]);r>=32;r-=32){n.push(e),e=0}if(0===r){return n.concat(i)}for(s=0;s<i.length;s++){n.push(e|i[s]>>>r),e=i[s]<<32-r}return o=i.length?i[i.length-1]:0,a=t.bitArray.getPartial(o),n.push(t.bitArray.partial(r+a&31,r+a>32?e:n.pop(),1)),n},_xor4:function(t,i){return[t[0]^i[0],t[1]^i[1],t[2]^i[2],t[3]^i[3]]}},t.codec.bytes={fromBits:function(i){var n,s,r=[],e=t.bitArray.bitLength(i);for(n=0;e/8>n;n++){0===(3&n)&&(s=i[n/4]),r.push(s>>>24),s<<=8}return r},toBits:function(i){var e,r=[],n=0;for(e=0;e<i.length;e++){n=n<<8|i[e],3===(3&e)&&(r.push(n),n=0)}return 3&e&&r.push(t.bitArray.partial(8*(3&e),n)),r}},t.codec.utf8String={fromBits:function(i){var n,s,r="",e=t.bitArray.bitLength(i);for(n=0;e/8>n;n++){0===(3&n)&&(s=i[n/4]),r+=String.fromCharCode(s>>>24),s<<=8}return decodeURIComponent(escape(r))},toBits:function(i){i=unescape(encodeURIComponent(i));var e,r=[],n=0;for(e=0;e<i.length;e++){n=n<<8|i.charCodeAt(e),3===(3&e)&&(r.push(n),n=0)}return 3&e&&r.push(t.bitArray.partial(8*(3&e),n)),r}},t.codec.hex={fromBits:function(i){var e,r="";for(e=0;e<i.length;e++){r+=((0|i[e])+0xf00000000000).toString(16).substr(4)}return r.substr(0,t.bitArray.bitLength(i)/4)},toBits:function(i){var r,n,e=[];for(i=i.replace(/\s|0x/g,""),n=i.length,i+="00000000",r=0;r<i.length;r+=8){e.push(0^parseInt(i.substr(r,8),16))}return t.bitArray.clamp(e,4*n)}},t.cipher.aes=function(i){this._tables[0][0][0]||this._precompute();var r,e,n,s,o,a=this._tables[0][4],h=this._tables[1],c=i.length,f=1;if(4!==c&&6!==c&&8!==c){throw new t.exception.invalid("invalid aes key size")}for(this._key=[s=i.slice(0),o=[]],r=c;4*c+28>r;r++){n=s[r-1],(r%c===0||8===c&&r%c===4)&&(n=a[n>>>24]<<24^a[n>>16&255]<<16^a[n>>8&255]<<8^a[255&n],r%c===0&&(n=n<<8^n>>>24^f<<24,f=f<<1^283*(f>>7))),s[r]=s[r-c]^n}for(e=0;r;e++,r--){n=s[3&e?r:r-4],o[e]=4>=r||4>e?n:h[0][a[n>>>24]]^h[1][a[n>>16&255]]^h[2][a[n>>8&255]]^h[3][a[255&n]]}},t.cipher.aes.prototype={encrypt:function(t){return this._crypt(t,0)},decrypt:function(t){return this._crypt(t,1)},_tables:[[[],[],[],[],[]],[[],[],[],[],[]]],_precompute:function(){var n,s,o,c,f,u,l,g,p,t=this._tables[0],i=this._tables[1],r=t[4],e=i[4],a=[],h=[];for(n=0;256>n;n++){h[(a[n]=n<<1^283*(n>>7))^n]=n}for(s=o=0;!r[s];s^=c||1,o=h[o]||1){for(l=o^o<<1^o<<2^o<<3^o<<4,l=l>>8^255&l^99,r[s]=l,e[l]=s,u=a[f=a[c=a[s]]],p=16843009*u^65537*f^257*c^16843008*s,g=257*a[l]^16843008*l,n=0;4>n;n++){t[n][s]=g=g<<24^g>>>8,i[n][l]=p=p<<24^p>>>8}}for(n=0;5>n;n++){t[n]=t[n].slice(0),i[n]=i[n].slice(0)}},_crypt:function(i,r){if(4!==i.length){throw new t.exception.invalid("invalid aes block size")}var h,c,f,l,e=this._key[r],n=i[0]^e[0],s=i[r?3:1]^e[1],o=i[2]^e[2],a=i[r?1:3]^e[3],u=e.length/4-2,g=4,p=[0,0,0,0],d=this._tables[r],y=d[0],_=d[1],v=d[2],b=d[3],w=d[4];for(l=0;u>l;l++){h=y[n>>>24]^_[s>>16&255]^v[o>>8&255]^b[255&a]^e[g],c=y[s>>>24]^_[o>>16&255]^v[a>>8&255]^b[255&n]^e[g+1],f=y[o>>>24]^_[a>>16&255]^v[n>>8&255]^b[255&s]^e[g+2],a=y[a>>>24]^_[n>>16&255]^v[s>>8&255]^b[255&o]^e[g+3],g+=4,n=h,s=c,o=f}for(l=0;4>l;l++){p[r?3&-l:l]=w[n>>>24]<<24^w[s>>16&255]<<16^w[o>>8&255]<<8^w[255&a]^e[g++],h=n,n=s,s=o,o=a,a=h}return p}},t.hash.sha256=function(t){this._key[0]||this._precompute(),t?(this._h=t._h.slice(0),this._buffer=t._buffer.slice(0),this._length=t._length):this.reset()},t.hash.sha256.hash=function(i){return(new t.hash.sha256).update(i).finalize()},t.hash.sha256.prototype={blockSize:512,reset:function(){return this._h=this._init.slice(0),this._buffer=[],this._length=0,this},update:function(i){"string"==typeof i&&(i=t.codec.utf8String.toBits(i));var r,e=this._buffer=t.bitArray.concat(this._buffer,i),n=this._length,s=this._length=n+t.bitArray.bitLength(i);for(r=512+n&-512;s>=r;r+=512){this._block(e.splice(0,16))}return this},finalize:function(){var i,r=this._buffer,e=this._h;for(r=t.bitArray.concat(r,[t.bitArray.partial(1,1)]),i=r.length+2;15&i;i++){r.push(0)}for(r.push(Math.floor(this._length/4294967296)),r.push(0|this._length);r.length;){this._block(r.splice(0,16))}return this.reset(),e},_init:[],_key:[],_precompute:function(){function e(t){return 4294967296*(t-Math.floor(t))|0}var r,t=0,i=2;t:for(;64>t;i++){for(r=2;i>=r*r;r++){if(i%r===0){continue t}}8>t&&(this._init[t]=e(Math.pow(i,.5))),this._key[t]=e(Math.pow(i,1/3)),t++}},_block:function(t){var i,r,e,n,s=t.slice(0),o=this._h,a=this._key,h=o[0],c=o[1],f=o[2],u=o[3],l=o[4],g=o[5],p=o[6],d=o[7];for(i=0;64>i;i++){16>i?r=s[i]:(e=s[i+1&15],n=s[i+14&15],r=s[15&i]=(e>>>7^e>>>18^e>>>3^e<<25^e<<14)+(n>>>17^n>>>19^n>>>10^n<<15^n<<13)+s[15&i]+s[i+9&15]|0),r=r+d+(l>>>6^l>>>11^l>>>25^l<<26^l<<21^l<<7)+(p^l&(g^p))+a[i],d=p,p=g,g=l,l=u+r|0,u=f,f=c,c=h,h=r+(c&f^u&(c^f))+(c>>>2^c>>>13^c>>>22^c<<30^c<<19^c<<10)|0}o[0]=o[0]+h|0,o[1]=o[1]+c|0,o[2]=o[2]+f|0,o[3]=o[3]+u|0,o[4]=o[4]+l|0,o[5]=o[5]+g|0,o[6]=o[6]+p|0,o[7]=o[7]+d|0}},t.misc.hmac=function(i,r){this._hash=r=r||t.hash.sha256;var n,e=[[],[]],s=r.prototype.blockSize/32;for(this._baseHash=[new r,new r],i.length>s&&(i=r.hash(i)),n=0;s>n;n++){e[0][n]=909522486^i[n],e[1][n]=1549556828^i[n]}this._baseHash[0].update(e[0]),this._baseHash[1].update(e[1]),this._resultHash=new r(this._baseHash[0])},t.misc.hmac.prototype.encrypt=t.misc.hmac.prototype.mac=function(i){if(this._updated){throw new t.exception.invalid("encrypt on already updated hmac called!")}return this.update(i),this.digest(i)},t.misc.hmac.prototype.reset=function(){this._resultHash=new this._hash(this._baseHash[0]),this._updated=!1},t.misc.hmac.prototype.update=function(t){this._updated=!0,this._resultHash.update(t)},t.misc.hmac.prototype.digest=function(){var t=this._resultHash.finalize(),i=new this._hash(this._baseHash[1]).update(t).finalize();return this.reset(),i},t.misc.pbkdf2=function(i,r,e,n,s){if(e=e||1e3,0>n||0>e){throw t.exception.invalid("invalid params to pbkdf2")}"string"==typeof i&&(i=t.codec.utf8String.toBits(i)),"string"==typeof r&&(r=t.codec.utf8String.toBits(r)),s=s||t.misc.hmac;var a,h,c,f,u,o=new s(i),l=[],g=t.bitArray;for(u=1;32*l.length<(n||1);u++){for(a=h=o.encrypt(g.concat(r,[u])),c=1;e>c;c++){for(h=o.encrypt(h),f=0;f<h.length;f++){a[f]^=h[f]}}l=l.concat(a)}return n&&(l=g.clamp(l,n)),l},t.mode.ccm={name:"ccm",encrypt:function(i,r,e,n,s){var o,c,h=r.slice(0),f=t.bitArray,u=f.bitLength(e)/8,l=f.bitLength(h)/8;if(s=s||64,n=n||[],7>u){throw new t.exception.invalid("ccm: iv must be at least 7 bytes")}for(o=2;4>o&&l>>>8*o;o++){}return 15-u>o&&(o=15-u),e=f.clamp(e,8*(15-o)),c=t.mode.ccm._computeTag(i,r,e,n,s,o),h=t.mode.ccm._ctrMode(i,h,e,c,s,o),f.concat(h.data,h.tag)},decrypt:function(i,r,e,n,s){s=s||64,n=n||[];var o,g,h=t.bitArray,c=h.bitLength(e)/8,f=h.bitLength(r),u=h.clamp(r,f-s),l=h.bitSlice(r,f-s);if(f=(f-s)/8,7>c){throw new t.exception.invalid("ccm: iv must be at least 7 bytes")}for(o=2;4>o&&f>>>8*o;o++){}if(15-c>o&&(o=15-c),e=h.clamp(e,8*(15-o)),u=t.mode.ccm._ctrMode(i,u,e,l,s,o),g=t.mode.ccm._computeTag(i,u.data,e,n,s,o),!h.equal(u.tag,g)){throw new t.exception.corrupt("ccm: tag doesn't match")}return u.data},_computeTag:function(i,r,e,n,s,o){var h,u,l,g=[],p=t.bitArray,d=p._xor4;if(s/=8,s%2||4>s||s>16){throw new t.exception.invalid("ccm: invalid tag length")}if(n.length>4294967295||r.length>4294967295){throw new t.exception.bug("ccm: can't deal with 4GiB or more data")}if(h=[p.partial(8,(n.length?64:0)|s-2<<2|o-1)],h=p.concat(h,e),h[3]|=p.bitLength(r)/8,h=i.encrypt(h),n.length){for(u=p.bitLength(n)/8,65279>=u?g=[p.partial(16,u)]:4294967295>=u&&(g=p.concat([p.partial(16,65534)],[u])),g=p.concat(g,n),l=0;l<g.length;l+=4){h=i.encrypt(d(h,g.slice(l,l+4).concat([0,0,0])))}}for(l=0;l<r.length;l+=4){h=i.encrypt(d(h,r.slice(l,l+4).concat([0,0,0])))}return p.clamp(h,8*s)},_ctrMode:function(i,r,e,n,s,o){var a,h,u,c=t.bitArray,f=c._xor4,g=r.length,p=c.bitLength(r);if(u=c.concat([c.partial(8,o-1)],e).concat([0,0,0]).slice(0,4),n=c.bitSlice(f(n,i.encrypt(u)),0,s),!g){return{tag:n,data:[]}}for(h=0;g>h;h+=4){u[3]++,a=i.encrypt(u),r[h]^=a[0],r[h+1]^=a[1],r[h+2]^=a[2],r[h+3]^=a[3]}return{tag:n,data:c.clamp(r,p)}}};var i="ccm",r=function(r,e,n){var s;if(r instanceof ArrayBuffer){var o=new Uint8Array(r);s=t.codec.bytes.toBits(o)}else{r instanceof Buffer&&(s=t.codec.bytes.toBits(r))}var a=t.codec.hex.toBits(n.salt),h=t.codec.hex.toBits(n.iv),c=t.misc.pbkdf2(e,a,n.iter).slice(0,n.ks/32),f=new t.cipher.aes(c),u=t.codec.utf8String.toBits(n.auth),l=t.mode[i].decrypt(f,s,h,u,n.ts);return t.codec.utf8String.fromBits(l)};return function(t,i,e){return r(t,e.options.password,i.decoding)}})();